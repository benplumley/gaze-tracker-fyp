<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="111,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T3U3">v</span> = homography_solve(<span class="var type1" id="S3T16U6">pin</span>, <span class="var type1" id="S4T16U7">pout</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="111,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% HOMOGRAPHY_SOLVE finds a homography from point pairs</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   V = HOMOGRAPHY_SOLVE(PIN, POUT) takes a 2xN matrix of input vectors and</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%   a 2xN matrix of output vectors, and returns the homogeneous</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%   transformation matrix that maps the inputs to the outputs, to some</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%   approximation if there is noise.</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   This uses the SVD method of</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%   http://www.robots.ox.ac.uk/%7Evgg/presentations/bmvc97/criminispaper/node3.html</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,11" id="srcline11">11</a></span><span class="line"><span class="comment">% David Young, University of Sussex, February 2008</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,13" id="srcline13">13</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T19:U4">~<span class="mxinfo " id="T19:U5">isequal(<span class="mxinfo " id="T18:U6">size(<span class="var type1" id="S3T16U15">pin</span>)</span>, <span class="mxinfo " id="T18:U8">size(<span class="var type1" id="S4T16U18">pout</span>)</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="111,14" id="srcline14">14</a></span><span class="line">    error(<span class="string">'Points matrices different sizes'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,15" id="srcline15">15</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,16" id="srcline16">16</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T19:U10"><span class="mxinfo " id="T2:U11">size(<span class="var type1" id="S3T16U28">pin</span>, 1)</span> ~= <span class="mxinfo " id="T2:U13">2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="111,17" id="srcline17">17</a></span><span class="line">    error(<span class="string">'Points matrices must have two rows'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,18" id="srcline18">18</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T2:U14"><span class="var type1" id="S8T2U37">n</span> = <span class="mxinfo " id="T2:U16">size(<span class="var type1" id="S3T16U40">pin</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,20" id="srcline20">20</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T19:U18"><span class="var type1" id="S8T2U45">n</span> &lt; <span class="mxinfo " id="T2:U20">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="111,21" id="srcline21">21</a></span><span class="line">    error(<span class="string">'Need at least 4 matching points'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,22" id="srcline22">22</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="111,24" id="srcline24">24</a></span><span class="line"><span class="comment">% Solve equations using SVD</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T9:U21"><span class="var type1" id="S9T9U53">x</span> = <span class="mxinfo " id="T9:U23"><span class="var type1" id="S4T16U55">pout</span>(<span class="mxinfo " id="T10:U25">1</span>, <span class="mxinfo " id="T11:U26">:</span>)</span></span>; <span class="mxinfo " id="T9:U27"><span class="var type1" id="S10T9U60">y</span> = <span class="mxinfo " id="T9:U29"><span class="var type1" id="S4T16U62">pout</span>(<span class="mxinfo " id="T10:U31">2</span>,<span class="mxinfo " id="T11:U32">:</span>)</span></span>; <span class="mxinfo " id="T9:U33"><span class="var type1" id="S11T9U67">X</span> = <span class="mxinfo " id="T9:U35"><span class="var type1" id="S3T16U69">pin</span>(<span class="mxinfo " id="T10:U37">1</span>,<span class="mxinfo " id="T11:U38">:</span>)</span></span>; <span class="mxinfo " id="T9:U39"><span class="var type1" id="S12T9U74">Y</span> = <span class="mxinfo " id="T9:U41"><span class="var type1" id="S3T16U76">pin</span>(<span class="mxinfo " id="T10:U43">2</span>,<span class="mxinfo " id="T11:U44">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T13:U45"><span class="var type1" id="S13T13U81">rows0</span> = <span class="mxinfo " id="T13:U47">zeros(<span class="mxinfo " id="T2:U48">3</span>, <span class="var type1" id="S8T2U85">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T13:U50"><span class="var type1" id="S15T13U88">rowsXY</span> = <span class="mxinfo " id="T13:U52">-<span class="mxinfo " id="T13:U53">[<span class="var type1" id="S11T9U92">X</span>; <span class="var type1" id="S12T9U94">Y</span>; <span class="mxinfo " id="T9:U56">ones(<span class="mxinfo " id="T2:U57">1</span>,<span class="var type1" id="S8T2U99">n</span>)</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T65:U59"><span class="var type1" id="S17T65U102">hx</span> = <span class="mxinfo " id="T65:U61">[<span class="var type1" id="S15T13U105">rowsXY</span>; <span class="var type1" id="S13T13U107">rows0</span>; <span class="mxinfo " id="T9:U64"><span class="var type1" id="S9T9U110">x</span>.*<span class="var type1" id="S11T9U111">X</span></span>; <span class="mxinfo " id="T9:U67"><span class="var type1" id="S9T9U114">x</span>.*<span class="var type1" id="S12T9U115">Y</span></span>; <span class="var type1" id="S9T9U117">x</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T65:U71"><span class="var type1" id="S18T65U120">hy</span> = <span class="mxinfo " id="T65:U73">[<span class="var type1" id="S13T13U123">rows0</span>; <span class="var type1" id="S15T13U125">rowsXY</span>; <span class="mxinfo " id="T9:U76"><span class="var type1" id="S10T9U128">y</span>.*<span class="var type1" id="S11T9U129">X</span></span>; <span class="mxinfo " id="T9:U79"><span class="var type1" id="S10T9U132">y</span>.*<span class="var type1" id="S12T9U133">Y</span></span>; <span class="var type1" id="S10T9U135">y</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T50:U83"><span class="var type1" id="S19T50U138">h</span> = <span class="mxinfo " id="T50:U85">[<span class="var type1" id="S17T65U141">hx</span> <span class="var type1" id="S18T65U142">hy</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,31" id="srcline31">31</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T19:U88"><span class="var type1" id="S8T2U146">n</span> == <span class="mxinfo " id="T2:U90">4</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="111,32" id="srcline32">32</a></span><span class="line">    [<span class="var type1" id="S20T56U151">U</span>, <span class="mxinfo " id="T2:U92">~</span>, <span class="mxinfo " id="T58:U93">~</span>] = svd(<span class="var type1" id="S19T50U156">h</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,33" id="srcline33">33</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,34" id="srcline34">34</a></span><span class="line">    [<span class="var type0" id="S20T0U161">U</span>, ~, ~] = svd(<span class="var type0" id="S19T0U166">h</span>, <span class="string">'econ'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="111,35" id="srcline35">35</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="111,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo " id="T3:U95"><span class="var type1" id="S2T3U170">v</span> = <span class="mxinfo " id="T3:U97">(<span class="mxinfo " id="T3:U98">reshape(<span class="mxinfo " id="T61:U99"><span class="var type1" id="S20T56U176">U</span>(<span class="mxinfo " id="T66:U101">:</span>,<span class="mxinfo " id="T10:U102">9</span>)</span>, 3, 3)</span>).'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="111,37" id="srcline37">37</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
